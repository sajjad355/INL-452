<div class="folder-custodian-content">
  
  <div class="details-header" style="margin-bottom: 30px;" *ngIf="!showDetails">
    <h1>List of Folders</h1>
  </div>

  <ng-container *ngIf="!showDetails">
    <div class="add-or-search">
      <button class="btn btn-secondary pl-3 pr-3 mr-4" style="height: 43px;" (click)="newFolder()" *ngIf="canEditFolder">
        <i class="fa fa-plus mr-3"></i>New Folder
      </button>
      <div class="btn-group mr-3" style="width: 100%;">
        <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
          <button class="btn btn-outline-secondary pl-3 pr-3" ngbDropdownToggle style="height: 43px; font-size: 14px;">Search by {{ searchBy }}&nbsp;</button>
          <div class="dropdown-menu" ngbDropdownMenu>
            <button ngbDropdownItem (click)="searchBy = 'Folder Title'; search.param = 'title'; search.searchValue = ''">Folder Title</button>
            <button ngbDropdownItem (click)="searchBy = 'Custodian'; search.param = 'custodianId'; search.searchValue = ''">Custodian</button>
            <button ngbDropdownItem (click)="searchBy = 'Folder ID'; search.param = 'barcode'; search.searchValue = ''">Folder ID</button>
            <button ngbDropdownItem (click)="searchBy = 'Study #'; search.param = 'studyNumber'; search.searchValue = ''">Study #</button>
          </div>
        </div>

        <select
          *ngIf="searchBy === 'Custodian'"
          #employee
          class="form-control search-bar btn-group"
          style="height: 43px; border-top-left-radius: 0; border-bottom-left-radius: 0; border-color: #6c757d;"
          (change)="search.searchValue = employee.value; searchFolder()"
        >
          <option value="-1" disabled>Choose Custodian</option>
          <option *ngFor="let user of employeeList" 
            [value]="user.userId"
          >
            {{ user.name }}
          </option>
        </select>

        <input
          *ngIf="searchBy !== 'Custodian'"
          style="border-top-left-radius: 0; border-bottom-left-radius: 0; border-color: #6c757d;"
          role="group" 
          autocomplete="off" 
          type="text" 
          class="form-control search-bar btn-group"
          placeholder="Search..." 
          aria-describedby="basic-addon1"
          [(ngModel)]="search.searchValue"
          (keyup.enter)="page=1; searchFolder()"
        >
      </div>
    </div>
      
    <div class="table-responsive tableFixHead p-0 m-0 mt-4 mb-4">
      <table class="table m-0">
        <thead>
          <tr>
            <th class="text-center" width="60"></th>
            <th width="200">Name</th>
            <th>Folder ID</th>
            <th>Custodian</th>
            <th>Date Added</th>
            <!-- <th>Created by</th> -->
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let folder of folders; let i = index" (click)="viewDetails(folder)">
            <td valign="middle" class="text-center"><i style="font-size: 20px;" class="far fa-folder"></i></td>
            <td width="200" valign="middle">{{ folder.title }}</td>
            <td width="200" valign="middle">{{ folder.barcode }}</td>
            <td valign="middle">{{ folder.custodian.name }}</td>
            <td valign="middle">{{ folder.creationTime | date: 'dd MMM yyyy' }}</td>
            <!-- <td valign="middle">{{ folder.createdBy }}</td> -->
            <td valign="middle">{{ folder.remarks }}</td>
          </tr>
          <tr *ngIf="folders == undefined || folders.length < 1">
            <td class="empty" colspan="5">No folder found. Try adding one.</td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <div *ngIf="allCount > 10" class="mt-3 mb-0">
      <p class="page-note"
        [style.text-align]="'center'">
        Showing {{ ((page-1) * 10) + 1 }} - {{ page*10 > allCount ? allCount : page*10 }} of {{ allCount }} Folders
      </p>
      <ngb-pagination class="d-flex justify-content-center" [collectionSize]="allCount" [(page)]="page" [rotate]="true"
        [boundaryLinks]="true" [maxSize]="5" aria-label="Default pagination" (pageChange)="loadPage()"></ngb-pagination>
    </div>
  </ng-container>

  <ng-container *ngIf="showDetails">
    <app-folder-details
      [folder]="showFolder" 
      [canEdit]="canEditFolder" 
      [isNew]="isNewFolder" 
      (updateFolder)="c($event)"
      (viewFolder)="viewDetails(showFolder)"
      (cancel)="reset()"
    >
    </app-folder-details>
  </ng-container>

</div>