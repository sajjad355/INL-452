<div class="tab-container" [class.blur]="isNew || selectedClient">
  <h2>Search Clients</h2>

  <div>
    <label>Active Clients <input type="checkbox" [(ngModel)]="searchCriteria.active" id="activeCheckBox" ></label>
  </div>

  <div class="input-group">
    <span class="input-group-text"
          id="basic-addon1"
          (click)="page=1; search()">
      <i class="fa fa-search" aria-hidden="true"></i>
    </span>
    <input type="text"
           class="form-control"
           placeholder="Search by company or contact name"
           [(ngModel)]="searchCriteria.key"
           (keyup.enter)="page = 1; search()">
  </div>

  <div class="row control-box">
    <div ngbDropdown class="d-inline-block">
      <!-- Import disabled for now - PScott - July 23, 2020
      <button class="btn btn-default menu-btn" id="dropdownBasic1" ngbDropdownToggle>
        <i class="fa fa-download" aria-hidden="true"></i>Import
      </button>
      -->
      <div ngbDropdownMenu aria-labelledby="dropdownBasic1" style="text-align: center;" (click)="hasHeader = true;">
        <div>
          <!-- <label>Has Header? <input type="checkbox" [checked]="hasHeader" (change)="hasHeader=!hasHeader"></label> -->
          <input type="file" #importfile (change)="loadFile($event)"></div>
      </div>
    </div>

    <button *ngIf="canManageClients" class="btn btn-default menu-btn"
            (click)="newClient()">
      <i class="fa fa-plus" aria-hidden="true"></i> New Client
    </button>
  </div>

  <div class="table-container">
    <table *ngIf="!isLoading" class="table table-hover table-scroll">
      <thead>
        <tr>
          <th *ngIf="viewColumn[0]" colspan="2">Company</th>
          <th *ngIf="viewColumn[1]" colspan="4">Contacts</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr class = "companyRecord" *ngFor="let i of displayedClients" [attr.id]="i?.clientCompanyId">
          <td colspan="2" *ngIf="viewColumn[0]">
            <a href="javascript:;" (click)="loadClient( i.clientCompanyId );"> {{i?.companyName}}</a>
          </td>
          <td colspan="4" *ngIf="viewColumn[1]">
            <div *ngIf="i?.contacts !== undefined && i?.contacts.length >= 1; else elseBlock">
              <div *ngFor="let c of i?.contacts; let ci = index" [class.contacts]="i?.contacts.length > 1">
                <b>{{c?.name}}</b>
                <br>
                <a [href]="'mailto:'+c?.email">{{c?.email}}</a>
                <br>
                {{c?.phone}}
              </div>
            </div>
            <ng-template #elseBlock>No contacts on file.</ng-template>
          </td>
        </tr>
        <tr *ngIf="displayedClients == undefined || displayedClients.length < 1">
          <td class="empty" colspan="14">Empty</td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="isLoading" class="loading-screen">
      <img class="loading-img" src="../../../assets/images/loading.gif" alt="Loading...">
    </div>

    <div *ngIf="count>10">
      <p class="page-note"
          [style.text-align]="'center'">
          Client {{((page-1)*10)+1}} - {{page*10>count?count:page*10}} of {{count}} Client(s)
      </p>
      <ngb-pagination class="d-flex justify-content-center"
                      [collectionSize]="count"
                      [(page)]="page"
                      (pageChange)="search()"
                      aria-label="Default pagination">
       </ngb-pagination>
    </div>
    <button class="btn btn-info"
            *ngIf="!isLoading&&searchCriteria.key!==''&&displayedClients.length == 10"
            [style.float]="'right'"
            (click)="page=page+1; search();">
            Load Next 10 Results
            <i class="fas fa-caret-right"></i>
    </button>
  </div>
</div>

<div class="slide" [style.right]="showClient?0+'px':-100+'%'">
  <div class="edit-container">
    <app-client-display [selectedClient]="selectedClient"
                        [isNew]="isNew"
                        [canManageClients]="canManageClients"
                        (updateClient)="saveClient($event)"
                        (cancel)="cancelEdit()">
    </app-client-display>
  </div>
</div>


